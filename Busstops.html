<!DOCTYPE HTML>
<!--
	Twenty by HTML5 UP
	html5up.net | @ajlkn
	Free for personal and commercial use under the CCA 3.0 license (html5up.net/license)
-->
<html>
	<head>
		<title>SkyTech: Easier</title>
		<meta charset="utf-8" />
		<meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no" />
		<link rel="stylesheet" href="assets/css/main.css" />
		<noscript><link rel="stylesheet" href="assets/css/noscript.css" /></noscript>
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.3.4/dist/leaflet.css" />
    <style>
        #map {
			height: 800px;
            width: 100%;
        }
		.dropbtn {
			background-color:	transparent;
			color: white;
			padding: 16px;
			font-size: 16px;
			border: 1px solid white;
			cursor: pointer;
		}

		.dropbtn:hover, .dropbtn:focus {
			background-color: 	#708090;
		}

		.dropdown {
			position: relative;
			display: inline-block;
		}

		.dropdown-content {
			display: none;
			position: absolute;
			background-color: 	#F5F5F5;
			min-width: 160px;
			overflow: auto;
			font-weight:500;
			box-shadow: 0px 5px 5px 0px #D8BFD8;
			z-index: 1;
		}

		.dropdown-content a {
			color: black;
			padding: 12px 16px;
			text-decoration: none;
			display: block;
		}

		.dropdown a:hover {
		background-color: #708090;
		opacity:0.5;}

		.show {display: block;}
    </style>	
	</head>
	<body class="index is-preload">
		<div id="page-wrapper">

			<!-- Header -->
				<header id="header" class="alt">
					<h1 id="logo"><a href="index.html">SkyTech <span>: Easier</span></a></h1>
					<!--<nav id="nav">
						<ul>
							<li class="current"><a href="index.html">Welcome</a></li>
							<li class="submenu">
								<a href="#">Layouts</a>
								<ul>
									<li><a href="left-sidebar.html">Left Sidebar</a></li>
									<li><a href="right-sidebar.html">Right Sidebar</a></li>
									<li><a href="no-sidebar.html">No Sidebar</a></li>
									<li><a href="contact.html">Contact</a></li>
									<li class="submenu">
										<a href="#">Submenu</a>
										<ul>
											<li><a href="#">Dolore Sed</a></li>
											<li><a href="#">Consequat</a></li>
											<li><a href="#">Lorem Magna</a></li>
											<li><a href="#">Sed Magna</a></li>
											<li><a href="#">Ipsum Nisl</a></li>
										</ul>
									</li>
								</ul>
							</li>
							<li><a href="#" class="button primary">Sign Up</a></li>
						</ul>
					</nav>-->
				</header>

			<!-- Banner -->
				<section id="banner">

					<!--
						".inner" is set up as an inline-block so it automatically expands
						in both directions to fit whatever's inside it. This means it won't
						automatically wrap lines, so be sure to use line breaks where
						appropriate (<br />).
					-->
					<div class="inner">

						<header>
							<h2>SkyTech</h2>
						</header>
						<p>This is <strong>Assignment 3</strong>: "Easier", 
						<br />
						Find Nearby App
						<br />
						by <a href="mailto:nus.skytech@gmail.com">SkyTech</a>.</p>
						<footer>
							<ul class="buttons stacked">
								<!-- <li><a href="#mapsection" class="button fit scrolly">Find Nearby ____</a></li> -->
									   <!-- <li class="dropdown"> -->
									   <!-- <ul class="dropdown-content"> -->
											<!-- <li><a  href="./BusStops.html">Where is the nearest BusStop?</a></li> -->
											<!-- <li><a  href="./Carpark.html">Where is the nearest Parking Lot?</a></li> -->
											<!-- <li><a  href="./TaxiAvailability.html">Where can I get a taxi?</a></li> -->
									   <!-- </ul> -->
									<!-- </li> -->
									
									<div class="dropdown">
							<button onclick="myFunction()" class="dropbtn">Find Nearby Applications</button>
							  <div id="myDropdown" class="dropdown-content">
								<a  href="./BusStops.html">Where is the nearest BusStop?</a>
								<a  href="./Carpark.html">Where is the nearest Parking Lot?</a>
								<a  href="./TaxiAvailability.html">Where can I get a taxi?</a>
							  </div>
							</div>

							<script>
							/* When the user clicks on the button, 
							toggle between hiding and showing the dropdown content */
							function myFunction() {
								document.getElementById("myDropdown").classList.toggle("show");
							}

							// Close the dropdown if the user clicks outside of it
							window.onclick = function(event) {
							  if (!event.target.matches('.dropbtn')) {

								var dropdowns = document.getElementsByClassName("dropdown-content");
								var i;
								for (i = 0; i < dropdowns.length; i++) {
								  var openDropdown = dropdowns[i];
								  if (openDropdown.classList.contains('show')) {
									openDropdown.classList.remove('show');
								  }
								}
							  }
							}
							</script>
									
							</ul>
							<ul class="buttons stacked">
								<li><a href="#mapsection" class="button fit scrolly">Find in the Map</a></li>
							</ul>
						</footer>

					</div>

				</section>

			<!-- Map -->
				<article id="mapsection">

					<header class="special container">
						<span class="icon fa-bar-chart-o"></span>
						<h2>Find<strong> Nearby</strong>: Nearest Bus Stops
						<br />
						
					</header>

					<!-- One -->
						<section class="wrapper style4 container">

							<!-- Content -->
								<div class="content" id="map">
									<section>
										<!--<a href="#" class="image featured"><img src="images/pic04.jpg" alt="" /></a>-->
										<!--<header>
											<h3>Dolore Amet Consequat</h3>
										</header>-->
									</section>
								</div>

						</section>

			<!-- Footer -->
				<footer id="footer">

					<ul class="icons">
						<li><a href="#" class="icon circle fa-twitter"><span class="label">Twitter</span></a></li>
						<li><a href="#" class="icon circle fa-facebook"><span class="label">Facebook</span></a></li>
						<li><a href="#" class="icon circle fa-google-plus"><span class="label">Google+</span></a></li>
						<li><a href="#" class="icon circle fa-github"><span class="label">Github</span></a></li>
						<li><a href="#" class="icon circle fa-dribbble"><span class="label">Dribbble</span></a></li>
					</ul>

					<ul class="copyright">
						<li>&copy; SkyTech</li><li>Assignment 3: <a href="mailto:nus.skytech@gmail.com">Easier</a></li>
					</ul>

				</footer>

		</div>

		<!-- Scripts -->
    <script src="https://unpkg.com/leaflet@1.3.4/dist/leaflet.js"></script>
    <script src="assets/js/leaflet-knn.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/Turf.js/5.1.5/turf.min.js"></script>
			<script src="assets/js/jquery.min.js"></script>
			<script src="assets/js/jquery.dropotron.min.js"></script>
			<script src="assets/js/jquery.scrolly.min.js"></script>
			<script src="assets/js/jquery.scrollex.min.js"></script>
			<script src="assets/js/browser.min.js"></script>
			<script src="assets/js/breakpoints.min.js"></script>
			<script src="assets/js/util.js"></script>
			<script src="assets/js/main.js"></script>
			
	<script>

		
		<!-- 图标信息 -->
		var Icon = L.icon({
			iconUrl: 'https://png.icons8.com/doodle/90/000000/bus.png',
			iconSize:     [50, 50],
			opacity:0.5,
			});
		var Icon2= L.icon({
		   iconUrl: 'https://png.icons8.com/ios-glyphs/90/2ecc71/popular-topic.png',
		   iconSize:     [30, 30],
		    });
		var Icon3 = L.icon({
		   iconUrl: 'https://png.icons8.com/plasticine/50/000000/place-marker.png',
		   iconSize:     [30, 30],
		    });
		var Icon4 = L.icon({
		   iconUrl: 'https://png.icons8.com/doodle/90/000000/taxi.png',
		   iconSize:     [30, 30],
		    });
		var Icon5 = L.icon({
		   iconUrl: 'https://png.icons8.com/doodle/90/000000/parking.png',
		   iconSize:     [30, 30],
		    });
			
		
		var center = L.bounds([1.56073, 104.11475], [1.16, 103.502]).getCenter();
        
		var map = L.map('map').setView([center.x, center.y], 12);
        
		var basemap = L.tileLayer('https://maps-{s}.onemap.sg/v3/Grey/{z}/{x}/{y}.png', {
          detectRetina: true,
          maxZoom: 18,
          minZoom: 11,
          //Do not remove this attribution
          attribution: '<img src="https://docs.onemap.sg/maps/images/oneMap64-01.png" style="height:20px;width:20px;"/> New OneMap | Map data © contributors, <a href="http://SLA.gov.sg">Singapore Land Authority</a>'
        });
		
		map.setMaxBounds([[1.56073, 104.1147], [1.16, 103.502]]);
		
        basemap.addTo(map);		
		
		var cpaData = 'cpa';
		var bsData = 'bs';
		var brData = 'br';
		var taData = 'ta';
		var dataType = '';
		
		<!-- 复制data数组 -->
		var datapoints = new Array();
		<!-- 转换turf信息 -->
		var turfpoints = new Array();
				
		
		
		function grabData(dataType, startFrom=0) {
			//var count = startFrom;
			// Get External API		
			var proxy = 'https://skytech-cors.herokuapp.com/';
			var url = "http://datamall2.mytransport.sg/ltaodataservice";
			
			switch (dataType) {
				case 'cpa':
					var dataURL = proxy + url + "/CarParkAvailabilityv2?$skip=" + startFrom;
					
					break;
				case 'bs':
					var dataURL = proxy + url + "/BusStops?$skip=" + startFrom;
					break;
				case 'br':
					var dataURL = proxy + url + "/BusRoutes?$skip=" + startFrom;
					break;
				case 'ta':
					var dataURL = proxy + url + "/Taxi-Availability?$skip=" + startFrom;
					
					break;
				default:
					var dataURL = "No Data";
			}
					
			$.ajax({
			url: dataURL,
			crossorigin: true,
			/*beforeSend: function(request) {
			  request.setRequestHeader("Access-Control-Allow-Origin","*");
			},*/
			headers: {
				'AccountKey':'pCIBG2tZdDaAHAoXyUL6+Q==',
				'Access-Control-Allow-Origin':'*',
				'Accept':'application/json',
				'Content-Type':'application/json'
			},
			method: 'GET',
			dataType: 'json',
			data: dataType,
			success: function(data){	
				//console.log(dataType + ' Success: '+ JSON.stringify(data));
				
				$.when(data).done(function(data) {
				
				//console.log('After Done: '+ JSON.stringify(data.value));
				
				var returns = JSON.stringify(data.value.length);
				
				//console.log('Item Counts: '+ returns);
				console.log(data);
				
				if (dataType == 'cpa'){
					for (i = 0; i < data.value.length; i++) {
					
					datapoints.push([data.value[i]]);
					//console.log("Latitude: " + data.value[i].Latitude + ' , ' + "Longitude: " + data.value[i].Longitude);
					
					//var marker = L.marker([data.value[i].Latitude, data.value[i].Longitude],).addTo(map).bindPopup("<b>BusStopCode: </b>" + data.value[i].BusStopCode + "<br>" + "<b>RoadName: </b>" + data.value[i].RoadName  + "<br>" + "<b>Description: </b>" + data.value[i].Description);
					
					//turfpoint[i] = turf.point([data.value[i].Latitude,data.value[i].Longitude]);
					//console.log(turfpoints[i]);
					data.value[i].Location = data.value[i].Location.split(" ");
					
					data.value[i].Location = [Number(data.value[i].Location[0]),Number(data.value[i].Location[1])];
					
					//console.log(data.value[i].Location[0]);
					if (data.value[i].Location[0] != 0){
						turfpoints.push(turf.point([data.value[i].Location[0],data.value[i].Location[1]]));
					}
					
					}
					
					console.log(turfpoints);
					
				}
				
				else if (dataType == 'bs'){
				for (i = 0; i < data.value.length; i++) {
					
					datapoints.push([data.value[i]]);
					//console.log("Latitude: " + data.value[i].Latitude + ' , ' + "Longitude: " + data.value[i].Longitude);
					
					//var marker = L.marker([data.value[i].Latitude, data.value[i].Longitude],).addTo(map).bindPopup("<b>BusStopCode: </b>" + data.value[i].BusStopCode + "<br>" + "<b>RoadName: </b>" + data.value[i].RoadName  + "<br>" + "<b>Description: </b>" + data.value[i].Description);
					
					//turfpoint[i] = turf.point([data.value[i].Latitude,data.value[i].Longitude]);
					//console.log(turfpoints[i]);
					turfpoints.push(turf.point([data.value[i].Latitude,data.value[i].Longitude]));

				}
				}
				
				
				else if (dataType == 'ta'){
					
					for (i = 0; i < data.value.length; i++) {
					
					datapoints.push([data.value[i]]);
					//console.log("Latitude: " + data.value[i].Latitude + ' , ' + "Longitude: " + data.value[i].Longitude);
					
					//var marker = L.marker([data.value[i].Latitude, data.value[i].Longitude],).addTo(map).bindPopup("<b>BusStopCode: </b>" + data.value[i].BusStopCode + "<br>" + "<b>RoadName: </b>" + data.value[i].RoadName  + "<br>" + "<b>Description: </b>" + data.value[i].Description);
					
					//turfpoint[i] = turf.point([data.value[i].Latitude,data.value[i].Longitude]);
					//console.log(turfpoints[i]);
					turfpoints.push(turf.point([data.value[i].Latitude,data.value[i].Longitude]));

					}
					console.log(datapoints);
					console.log(turfpoints);
				}
				
				
				
				
				if (returns == 500){
					startFrom += 500;
					grabData(dataType, startFrom);
				}

				})
				
				
				
			},
			
			
			error: function(err){
				console.log(dataType + ' Error: '+ JSON.stringify(err));
			}
				})
			};
		
        // Specify that this code should run once the cpaData request is complete
		
		dataType = 'bs';
		
		if (dataType == 'cpa'){
			grabData(cpaData);
		}
		else if(dataType == 'bs')
		{
			grabData(bsData);
		}
		else if(dataType == 'ta')
		{
			grabData(taData);
		}
		else if(dataType == 'br')
		{
			grabData(brData);
		}
		
		
		console.log(datapoints);
		console.log(turfpoints);

		var theMarker = new Array();
		var nearestMarker = new Array();
		var ptsWithinMarker  = new Array();
		var Markers= new Array();
		var circle = [];
		
		if (dataType == 'cpa'){
				<!-- 点击触发最近停车场 -->
			map.on('click',function(e){

			lat = e.latlng.lat;
			lng = e.latlng.lng;
						
			if (theMarker != undefined) {
				map.removeLayer(theMarker);
			};
			
			if (nearestMarker != undefined) {
				map.removeLayer(nearestMarker);
			};
			if (circle != undefined) {
				map.removeLayer(circle);
			};
			
			
			for(n=0;n<ptsWithinMarker.length;n++){
				
				map.removeLayer(ptsWithinMarker[n]);
	
			};
			
			for(n=0;n<ptsWithinMarker.length;n++){
				
				//ptsWithinMarker.pop();
				ptsWithinMarker.splice(n,1);
			};
			
			
			theMarker = L.marker([lat,lng],{icon:Icon2}).addTo(map);
			
			var targetPoint = turf.point([e.latlng.lat, e.latlng.lng], {"marker-color": "#0F0"});
			
			var points = turf.featureCollection(turfpoints);
			
			var nearest = turf.nearestPoint(targetPoint, points);
			
			console.log(nearest);
			
			console.log(nearest.geometry.coordinates);
			

			<!-- lat lng 转换 -->
			
			var newpoints = turf.flip(points);
			var newtargetpoint =  turf.point([e.latlng.lng, e.latlng.lat]);
			
			
			var buffered = turf.buffer(newtargetpoint, 2, {units: 'kilometers'});
		
			
			var ptsWithin = turf.pointsWithinPolygon(newpoints, buffered);
			console.log(ptsWithin);
			
			

			circle = L.circle([lat,lng], {
				color: 'black',
				fillColor: 'gray',
				fillOpacity: 0.3,
				radius: 2000.0
			}
			).addTo(map);

			for( n = 0 ; n < ptsWithin.features.length; n++ ){
				
				//console.log(ptsWithin.features[n].geometry.coordinates);
				
				ptsWithinMarker.push(L.marker([ptsWithin.features[n].geometry.coordinates[1],ptsWithin.features[n].geometry.coordinates[0]],{icon:Icon3}).addTo(map).bindPopup("<b>You can park here!</b>"));
				
					
				//ptsWithinMarker = L.marker([ptsWithin.features[n].geometry.coordinates[1],ptsWithin.features[n].geometry.coordinates[0]],{icon:Icon3}).addTo(map).bindPopup("<b>I am the busstop within 800m</b>");

				//Markers.push(ptsWithinMarker);
			}
			console.log(ptsWithinMarker);
			
			
			<!-- 显示最近的车站 -->
			var i = nearest.properties.featureIndex;
			//console.log(i);
			nearestMarker =  L.marker(nearest.geometry.coordinates,{icon:Icon5}).addTo(map).bindPopup("Nearest Parking Lot!");
			
			console.log(nearestMarker);
			
		});
		
		}
		else if(dataType == 'bs')
		{
				<!-- 点击触发最近公交车站 -->
			map.on('click',function(e){

			lat = e.latlng.lat;
			lng = e.latlng.lng;
						
			if (theMarker != undefined) {
				map.removeLayer(theMarker);
			};
			
			if (nearestMarker != undefined) {
				map.removeLayer(nearestMarker);
			};
			if (circle != undefined) {
				map.removeLayer(circle);
			};
			
			
			for(n=0;n<ptsWithinMarker.length;n++){
				
				map.removeLayer(ptsWithinMarker[n]);
	
			};
			
			for(n=0;n<ptsWithinMarker.length;n++){
				
				//ptsWithinMarker.pop();
				ptsWithinMarker.splice(n,1);
			};
			
			
			theMarker = L.marker([lat,lng],{icon:Icon2}).addTo(map);
			
			var targetPoint = turf.point([e.latlng.lat, e.latlng.lng], {"marker-color": "#0F0"});
			
			var points = turf.featureCollection(turfpoints);
			
			var nearest = turf.nearestPoint(targetPoint, points);
			
			console.log(nearest);
			
			console.log(nearest.geometry.coordinates);
			

			<!-- lat lng 转换 -->
			
			var newpoints = turf.flip(points);
			var newtargetpoint =  turf.point([e.latlng.lng, e.latlng.lat]);
			
			
			var buffered = turf.buffer(newtargetpoint, 0.8, {units: 'kilometers'});
		
			
			var ptsWithin = turf.pointsWithinPolygon(newpoints, buffered);
			console.log(ptsWithin);
			
			

			circle = L.circle([lat,lng], {
				color: 'black',
				fillColor: 'gray',
				fillOpacity: 0.3,
				radius: 800.0
			}
			).addTo(map);

			for( n = 0 ; n < ptsWithin.features.length; n++ ){
				
				//console.log(ptsWithin.features[n].geometry.coordinates);
				
				ptsWithinMarker.push(L.marker([ptsWithin.features[n].geometry.coordinates[1],ptsWithin.features[n].geometry.coordinates[0]],{icon:Icon3}).addTo(map).bindPopup("<b>I am the busstop within 800m</b>"));
				
					
				//ptsWithinMarker = L.marker([ptsWithin.features[n].geometry.coordinates[1],ptsWithin.features[n].geometry.coordinates[0]],{icon:Icon3}).addTo(map).bindPopup("<b>I am the busstop within 800m</b>");

				//Markers.push(ptsWithinMarker);
			}
			console.log(ptsWithinMarker);
			
			
			<!-- 显示最近的车站 -->
			var i = nearest.properties.featureIndex;
			//console.log(i);
			nearestMarker =  L.marker(nearest.geometry.coordinates,{icon:Icon}).addTo(map).bindPopup("<b>BusStopCode: </b>" + datapoints[i][0].BusStopCode + "<br>" + "<b>RoadName: </b>" + datapoints[i][0].RoadName  + "<br>" + "<b>Description: </b>" + datapoints[i][0].Description);
			
			console.log(nearestMarker);
			
		});
		
		}
		else if(dataType == 'ta')
		{
				<!-- 点击触发最近Taxi -->
			map.on('click',function(e){

			lat = e.latlng.lat;
			lng = e.latlng.lng;
						
			if (theMarker != undefined) {
				map.removeLayer(theMarker);
			};
			
			if (nearestMarker != undefined) {
				map.removeLayer(nearestMarker);
			};
			if (circle != undefined) {
				map.removeLayer(circle);
			};
			
			
			for(n=0;n<ptsWithinMarker.length;n++){
				
				map.removeLayer(ptsWithinMarker[n]);
	
			};
			
			for(n=0;n<ptsWithinMarker.length;n++){
				
				//ptsWithinMarker.pop();
				ptsWithinMarker.splice(n,1);
			};
			
			
			theMarker = L.marker([lat,lng],{icon:Icon2}).addTo(map);
			
			var targetPoint = turf.point([e.latlng.lat, e.latlng.lng], {"marker-color": "#0F0"});
			
			var points = turf.featureCollection(turfpoints);
			
			var nearest = turf.nearestPoint(targetPoint, points);
			
			console.log(nearest);
			
			console.log(nearest.geometry.coordinates);
			

			<!-- lat lng 转换 -->
			
			var newpoints = turf.flip(points);
			var newtargetpoint =  turf.point([e.latlng.lng, e.latlng.lat]);
			
			
			var buffered = turf.buffer(newtargetpoint, 0.8, {units: 'kilometers'});

			var ptsWithin = turf.pointsWithinPolygon(newpoints, buffered);
			console.log(ptsWithin);


			circle = L.circle([lat,lng], {
				color: 'black',
				fillColor: 'gray',
				fillOpacity: 0.3,
				radius: 800.0
			}
			).addTo(map);

			for( n = 0 ; n < ptsWithin.features.length; n++ ){
				
				//console.log(ptsWithin.features[n].geometry.coordinates);
				
				ptsWithinMarker.push(L.marker([ptsWithin.features[n].geometry.coordinates[1],ptsWithin.features[n].geometry.coordinates[0]],{icon:Icon3}).addTo(map).bindPopup("<b>taxi available</b>"));
				
					
				//ptsWithinMarker = L.marker([ptsWithin.features[n].geometry.coordinates[1],ptsWithin.features[n].geometry.coordinates[0]],{icon:Icon3}).addTo(map).bindPopup("<b>I am the busstop within 800m</b>");

				//Markers.push(ptsWithinMarker);
			}
			console.log(ptsWithinMarker);
			
			
			<!-- 显示最近的车站 -->
			var i = nearest.properties.featureIndex;
			//console.log(i);
			nearestMarker =  L.marker(nearest.geometry.coordinates,{icon:Icon4}).addTo(map).bindPopup("Nearest Taxi Pick-up Point!");
			
			console.log(nearestMarker);
			
		});
		
		}
		else if(dataType == 'br')
		{
				<!-- 点击触发最近路线 -->
		map.on('click',function(e){

			lat = e.latlng.lat;
			lng = e.latlng.lng;
						
			if (theMarker != undefined) {
				map.removeLayer(theMarker);
			};
			
			if (nearestMarker != undefined) {
				map.removeLayer(nearestMarker);
			};
			if (circle != undefined) {
				map.removeLayer(circle);
			};
			
			
			for(n=0;n<ptsWithinMarker.length;n++){
				
				map.removeLayer(ptsWithinMarker[n]);
	
			};
			
			for(n=0;n<ptsWithinMarker.length;n++){
				
				//ptsWithinMarker.pop();
				ptsWithinMarker.splice(n,1);
			};
			
			
			theMarker = L.marker([lat,lng],{icon:Icon2}).addTo(map);
			
			var targetPoint = turf.point([e.latlng.lat, e.latlng.lng], {"marker-color": "#0F0"});
			
			var points = turf.featureCollection(turfpoints);
			
			var nearest = turf.nearestPoint(targetPoint, points);
			
			console.log(nearest);
			
			console.log(nearest.geometry.coordinates);
			

			<!-- lat lng 转换 -->
			
			var newpoints = turf.flip(points);
			var newtargetpoint =  turf.point([e.latlng.lng, e.latlng.lat]);
			
			
			var buffered = turf.buffer(newtargetpoint, 0.8, {units: 'kilometers'});
		
			
			var ptsWithin = turf.pointsWithinPolygon(newpoints, buffered);
			console.log(ptsWithin);
			
			

			circle = L.circle([lat,lng], {
				color: 'black',
				fillColor: 'gray',
				fillOpacity: 0.3,
				radius: 800.0
			}
			).addTo(map);

			for( n = 0 ; n < ptsWithin.features.length; n++ ){
				
				//console.log(ptsWithin.features[n].geometry.coordinates);
				
				ptsWithinMarker.push(L.marker([ptsWithin.features[n].geometry.coordinates[1],ptsWithin.features[n].geometry.coordinates[0]],{icon:Icon3}).addTo(map).bindPopup("<b>I am the busstop within 800m</b>"));
				
					
				//ptsWithinMarker = L.marker([ptsWithin.features[n].geometry.coordinates[1],ptsWithin.features[n].geometry.coordinates[0]],{icon:Icon3}).addTo(map).bindPopup("<b>I am the busstop within 800m</b>");

				//Markers.push(ptsWithinMarker);
			}
			console.log(ptsWithinMarker);
			
			
			<!-- 显示最近的车站 -->
			var i = nearest.properties.featureIndex;
			//console.log(i);
			nearestMarker =  L.marker(nearest.geometry.coordinates,{icon:Icon}).addTo(map).bindPopup("<b>BusStopCode: </b>" + datapoints[i][0].BusStopCode + "<br>" + "<b>RoadName: </b>" + datapoints[i][0].RoadName  + "<br>" + "<b>Description: </b>" + datapoints[i][0].Description);
			
			console.log(nearestMarker);
			
		});
		
		}
		
    </script>			

	</body>
</html>